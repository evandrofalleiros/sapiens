<link rel="import" href="/components/polymer/polymer.html">

<dom-module id="sapiens-create-view">
	<template>
		<content select=".sapiens-form"></content>		
	</template>

	<script>
		Polymer({
			is: 'sapiens-create-view', 

			behaviors: [Polymer.NeonAnimatableBehavior],

			properties: {
				model: { type: Object },

				entityObj: { 
					type: Object, 
					notify: true 
				},

	    	animationConfig: {
	    		value: function(){
	    			return {
	    				'entry': [{
	    					name: 'slide-from-right-animation',
	    					node: this
	    				},{
	    					name: 'fade-in-animation',
	    					node: this
	    				}],

	    				'exit': [{
	    					name: 'slide-right-animation',
	    					node: this
	    				}, {
	    					name: 'fade-out-animation',
	    					node: this
	    				}]
	    			}
	    		}
	    	}
		  },

	    listeners: {
				'iron-form-submit': '_handleSubmit'
			},

			config: function(cfg){
				for (key in cfg){
					this[key] = cfg[key]
				}
			},

	    save: function(evt){
	    	document.querySelector('.sapiens-form').submit();
	    },		

			_handleSubmit: function(evt){
				evt.preventDefault();

				var editing = document.querySelector('sapiens-app').state === 'editing';

				if(!editing){
					this.entityObj.createdAt = new Date();
					this.model.insert(this.entityObj);
				}else{
					var query = { _id: this.entityObj._id };
					var update = this.entityObj;

					this.model.update(query, update);
				}

				this.clearForm();
				this._scope.back();
			},

			clearForm: function(){
				this.entityObj = {};
			}
		});
	</script>

</dom-module>