<link rel="import" href="/components/polymer/polymer.html">
<link rel="import" href="sapiens-create-view.html">
<link rel="import" href="sapiens-list-view.html">

<dom-module id="sapiens-crud">
	<template>
		<neon-animated-pages id="viewPage" selected="[[selected]]" class="vertical layout">
			
			<sapiens-list-view type="{{listStyle}}" id="list" collection="{{collection}}">				
			</sapiens-list-view>	

			<sapiens-create-view id="create" entity-obj="{{entityObj}}">
				<content select=".sapiens-form"></content>
			</sapiens-create-view>		
			
		</neon-animated-pages>
	</template>

	<script>
		Polymer({
			is: 'sapiens-crud',

			properties: {
				collection: { type: Object },
				
				listHeader: { type: String },
				editHeader: { type: String },
				listStyle: { type: String},
				createHeader: {type: String},

				titleProp: {type: String},
				subtitleProp: {type: String},
				contentProp: {type: String},			

				entityObj: { 
					type: Object, 
					notify: true 
				},

				selected: {
			      	type: Number,
			      	value: 0
			    }
			},

			edit: function(entityObj){
				this.selected = 1;
				this.entityObj = entityObj;

				this.app.changeView({
			      	title: this.editHeader,
			     	state: 'editing',
			    	activeViewElement: this.$.create
				});
			},

			back: function(){
    		this.selected = 0;

    		this.app.changeView({
	      	title: this.listHeader,
		     	state: 'normal',
		    	activeViewElement: this.$.list
		    });
    	},

    	cardConfig: function(cfg){
    		this.$.list.titleProp = cfg.titleProp;
    		this.$.list.subtitleProp = cfg.subtitleProp;
    		this.$.list.contentProp = cfg.contentProp;
    	},
	    
	    ready: function() {
	    	this.app = document.querySelector('sapiens-app');
	      	var _this = this;

		    var cfg = { 
		    	_app: this.app, 
		    	_scope: this,
		    	model: window[this.collection]
		   	}

		   	this.scope = this.$.viewPage;
		    
		   	this.$.create.config(cfg);
		   	this.$.list.config(cfg);

		   	app.backAction = function(evt) {
		        _this.selected = 0;
		       	
		       	app.changeView({
		      		title: _this.listHeader,
		      		state: 'normal',
		      		activeViewElement: _this.$.list
		      	});
		    };

		    this.$.list._onAddClick = function(evt){
	      		_this.selected = 1;
	      		_this.entityObj = {};

		      	app.changeView({
		      		title: _this.createHeader,
		      		state: 'creating',
		      		activeViewElement: _this.$.create
		      	});		      	
	    	};
		  }
		})
	</script>

</dom-module>